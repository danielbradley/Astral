-	Astral Factory
--	D.Bradley

!
~include/astral/AstralFactory.h~
/*** !!! Autogenerated from source/mtx/AstralFactory.mtx !!! ***/
~
!

!
~source/cplusplus/AstralFactory.cpp~
/*** !!! Autogenerated from source/mtx/AstralFactory.mtx !!! ***/
~
!

.	About

The *Astral Factory* class allows user code to instantiate an Astral object that has been populated from recursively searching from user supplied directories -- when instantiated directly the *Astral* object is populated by individual source files.

General usage is as follows:

~
#include <astral/Astral.h>
#include <astral/AstralFactory.h>
#include <openxds.adt.std/Sequence.h>
#include <openxds.io/Path.h>

...

using namespace openxds::adt::std;
using namespace openxds::io;
using namespace astral;

...

Sequence<Path> sequence;
sequence.insertLast( new Path( "<directory>" ) );
sequence.insertLast( new Path( "<directory>" ) );

Astral* astral = AstralFactory::createAstral( sequence, ".java" );

... usage code here ...

delete astral;
~


.	Implementation

..		Header - astral/AstralFactory.h

!
~include/astral/AstralFactory.h~
#ifndef ASTRAL_ASTRALFACTORY_H
#define ASTRAL_ASTRALFACTORY_H
~
!

The *AstralFactory* class makes use of the following libraries:

~include/astral/AstralFactory.h~
#include "astral.h"
~

~include/astral/AstralFactory.h~
#include <openxds.adt.h>
#include <openxds.io.h>
#include <openxds/Object.h>
~

~include/astral/AstralFactory.h~
class AstralFactory : openxds::Object
{
public:
	static astral::Astral*
	createAstral(
		const openxds::adt::IList<openxds::io::Path>& pathList,
		const char*                                   extension
	);

	static astral::AstralExport*
	createAstralExport(
		const openxds::adt::IList<openxds::io::Path>& pathList,
		const char*                                   extension
	);
};
~

!
~include/astral/AstralFactory.h~
#endif
~
!

..		Body - source/cplusplus/AstralFactory.cpp

!
~source/cplusplus/AstralFactory.cpp~
#include "astral/Astral.h"
#include "astral/AstralExport.h"
#include "astral/AstralFactory.h"
~
!

!
~source/cplusplus/AstralFactory.cpp~
#include <openxds.io/Directory.h>
#include <openxds.io/Path.h>
#include <openxds.adt.std/Sequence.h>
#include <openxds.adt/IList.h>
#include <openxds.adt/IPIterator.h>
#include <openxds.base/String.h>
~
!

!
~source/cplusplus/AstralFactory.cpp~
using namespace astral;
using namespace openxds::adt;
using namespace openxds::adt::std;
using namespace openxds::base;
using namespace openxds::io;
~
!

!
~source/cplusplus/AstralFactory.cpp~
static void      processPaths( Astral& astral, const IList<Path>& pathList, const char* extension );
static void recursivelySearch( Astral& astral, const Path& path,            const char* extension );
~
!




...			Class method: createAstral

The *createAstral* method recursively searches each path provided in the /pathList/ for files with a suffix matching the supplied /extension/.

~source/cplusplus/AstralFactory.cpp~
Astral*
AstralFactory::createAstral( const IList<Path>& pathList, const char* extension )
{
	Astral* astral = new Astral();
	{
		processPaths( *astral, pathList, extension );
	}
	return astral;
}
~

...			Class method: createAstralExport

The *createAstralExport* method instantiates an *AstralExport* object and populates it by calling *processPaths*.

~source/cplusplus/AstralFactory.cpp~
AstralExport*
AstralFactory::createAstralExport( const IList<Path>& pathList, const char* extension )
{
	AstralExport* astral = new AstralExport();
	{
		processPaths( *astral, pathList, extension );
	}
	return astral;
}
~

...			Static procedure: processPath


The *processPath* method causes each path in the /pathList/ to be recursively searched by calling *recursivelySearch*.

~source/cplusplus/AstralFactory.cpp~
static void processPaths( Astral& astral, const IList<Path>& pathList, const char* extension )
{
	IPIterator<Path>* it = pathList.positions();
	while ( it->hasNext() )
	{
		IPosition<Path>* p = it->next();
		{
			const Path& path = p->getElement();
			recursivelySearch( astral, path, extension );
		}
		delete p;
	}
	delete it;
}
~

...			Static procedure: recursivelySearch

~source/cplusplus/AstralFactory.cpp~
static void recursivelySearch( Astral& astral, const Path& path, const char* extension )
{
	Directory current( path.getAbsolute().getChars() );
	IList<String>* files = current.retrieveFileList();
	{
		IPIterator<String>* it = files->positions();
		while ( it->hasNext() )
		{
			IPosition<String>* p = it->next();
			{
				const String& filename = p->getElement();
				if ( ! filename.startsWith( "." ) )
				{
					Path* child = path.childPath( filename );
					if ( child->getExtension().contentEquals( extension ) )
					{
						astral.add( child->getAbsolute() );
					}
					else
					{
						Directory possible( child->getAbsolute().getChars() );
						if ( possible.exists() )
						{
							recursivelySearch( astral, *child, extension );
						}
					}
					delete child;
				}
			}
			delete p;
		}
		delete it;
	}
	delete files;
}
~










